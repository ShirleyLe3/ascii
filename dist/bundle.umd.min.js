((t,n)=>{"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).ascii={})})(this,(function(t){"use strict";const n=String.fromCharCode,e=t=>t.charCodeAt(0),r=t=>{const[r,i]=[...t].map(e),o=[...Array(i-r).keys()].map(t=>r+t);return n(...o,i)},i=r(" ^")+r("`~"),o=i+r("¡§")+"®°±©«¬´µ·»¿×÷",s={__proto__:null,ascii:i,extended:o,extra:o+r("‘•")+"‹›∙√∞"},a=t=>t>.04045?((t+.055)/1.055)**2.4:t/12.92,{abs:c,clz32:u,floor:f,max:l,random:h,round:d}=Math,v=Object.assign,m=v,p=t=>(...n)=>m(document.createElement(t),...n),x=CanvasRenderingContext2D,g=(t,n)=>v([t,n,t/n],{width:t,height:n,ratio:t/n}),_=t=>t instanceof x?t.canvas:t,y=t=>{if(t instanceof HTMLVideoElement)return g(t.videoWidth,t.videoHeight);if(t instanceof HTMLImageElement)return g(t.naturalWidth,t.naturalHeight);const n=_(t);return g(n.width,n.height)},P=t=>{const n=p("canvas")(),e=n.getContext("2d");return(r,i)=>{var o;return m(n,{width:r,height:i}),null===(o=t)||void 0===o||o(e),e}},M=t=>1<<l(0,31-u(t)),w=()=>{const t=(()=>{const t=P();return(n,e,r)=>{const i=t(e,r);return i.drawImage(_(n),0,0,e,r),i}})(),n=(()=>{const t=P();return(n,e,r,i=0,o=0)=>{const s=t(e,r);return s.drawImage(_(n),i,o,e,r,0,0,e,r),s}})();return(e,r,i)=>{const[o,s]=y(e);let a=r*M(o/r-1),c=i*M(s/i-1);const u=t(e,a,c);if(r===a&&i===c)return u;for(let t,n;t=a>r,n=c>i,t||n;)u.drawImage(u.canvas,0,0,a,c,0,0,a>>=+t,c>>=+n);return n(u,r,i)}},$=P(),S=w();class b extends Float32Array{constructor(t,n){super(t*n),this.width=t,this.height=n}static fromCharCode(t,e){const{fontWidth:r,fontHeight:i,fontFamily:o,fontBlur:s,fontGamma:c}=e,{fontBase:u,lutWidth:f,lutHeight:l,lutPadding:h,lutGamma:v}=e,m=2*h+f,p=2*h+l,x=d(m/f*r),g=d(p/l*i),_=$(x,g),y=n(t);_.fillStyle="#00f",_.fillRect(0,0,x,g),_.translate(x/2,g/2),_.fillStyle="#000",_.fillRect(-r/2,-i/2,r,i),_.translate(0,i*(.5-u)),_.fillStyle="#fff",_.textAlign="center",_.font=`${i}px ${o}`;for(let t=0,n=1,e=1;s>t;[n,e]=[e,e+n])_.filter=`blur(${e}px)`,_.globalAlpha=(++t/s)**c,_.fillText(y,0,0);const P=new b(f,l),M=S(_,m,p).getImageData(h,h,f,l).data;for(let t=0;P.length>t;t++)P[t]=a(M[t<<2]/255)**v;return P}static combine(t){const n=t[0].length,e=t.length,r=new b(n,e);for(let i=0;e>i;i++)r.set(t[i],i*n);return r}normalize(t,n){for(let e=this.length;e--;)this[e]=(this[e]-t)/(n-t)}compare(t){let n=0;for(let e=this.length;e--;)n+=c(this[e]-t[e]);return n}}const C={charSet:i,fontFamily:"monospace",fontBase:.25,fontWidth:40,fontHeight:70,fontBlur:9,fontGamma:1,lutWidth:5,lutHeight:7,lutPadding:1,lutMin:0,lutMax:1,lutGamma:1,gamma:1,signal:1,noise:0},L=t=>{const n=P(n=>n.font=`1em ${t}`)(0,0),e=n.measureText(" ");return t=>n.measureText(t).width===e.width};class U{constructor(t){this.t=(()=>{const t=w();return(n,e,r)=>{const[i,o]=y(n);return e!==i||r!==o?t(n,e,r):n}})(),this.settings={...C,...t},this.i=this.o(),this.s=this.u()}o(){const{charSet:t,fontFamily:n}=this.settings,r=[...t].filter(L(n)).map(e);return Int32Array.from(r)}u(){const{i:t,settings:n}=this,{lutMin:e,lutMax:r}=n,i=Array.from(t,t=>b.fromCharCode(t,n)),o=i.reduce((t,n)=>l(t,...n),0);for(const t of i)t.normalize(e*o,r*o);return i}render(t,n,e){return[...this.lines(t,f(n),f(e))].join("\n")}}const B=(t,n,e)=>r=>(r&&(e(n),r(t,n),e(null)),n),G=(t,n)=>e=>t.getUniformLocation(n,e),A=(t,n=3553)=>{const e=t.createTexture();return B(t,e,e=>t.bindTexture(n,e))},z=(t,n,e)=>{const r=`#version 300 es\n${e}`,i=t.createShader(n);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,35713)){const n=t.getShaderInfoLog(i);throw Error(`Shader error:\n${n}\n${((t,n=1)=>t.replace(/^/gm,()=>`${n++}: `.padStart(5,"0")))(r)}\n`)}return i},E=(t,n,e)=>{const r=t.createProgram();if(t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),!t.getProgramParameter(r,35714)){const n=t.getProgramInfoLog(r);throw Error(`Program error: ${n}`)}return r},F="in vec2 aPosition;\nout vec2 vPosition;\nvoid main() {\nvPosition = .5 + .5*aPosition;\ngl_Position = vec4(aPosition, 0., 1.);\n}\n",O="#define MAP3(fn, v3) vec3(fn(v3.x), fn(v3.y), fn(v3.z))\n#define RGB(v1) mix(v1/12.92, pow((v1+.055)/1.055, 2.4), step(.04045, v1))\n#define LUM(v3) dot(MAP3(RGB, v3), vec3(.2126, .7152, .0722))\nprecision highp float;\nuniform sampler2D uSrc;\nuniform float uGamma;\nuniform float uSignal;\nuniform float uNoise;\nuniform float uRandom;\nin vec2 vPosition;\nout float vOutput;\nfloat hash13(vec3 p3) {\np3 = fract(p3 * 1031.);\np3 += dot(p3, p3.yzx + 19.19);\nreturn fract((p3.x + p3.y) * p3.z);\n}\nvoid main() {\nvec4 t = texture(uSrc, vPosition);\nfloat s = pow(LUM(t), uGamma);\nfloat n = hash13(vec3(vPosition, uRandom)) - 0.5;\nvOutput = uSignal*s + uNoise*n;\n}\n",T="#define U ${ width }\n#define V ${ height }\n#define X ${ width * height }\n#define Y ${ chars }\n#define Block float[X]\n#define CharCode int\nprecision highp float;\nuniform sampler2D uSrc;\nuniform sampler2D uLUT;\nuniform int uCharMap[Y];\nin vec2 vPosition;\nout int vOutput;\nBlock read() {\nvec2 center = vec2(textureSize(uSrc, 0))*vPosition;\nivec2 topLeft = ivec2(center) - ivec2(U, V)/2;\nBlock src;\nfor (int v = 0; v < V; v++)\nfor (int u = 0; u < U; u++)\nsrc[u + v*U] = texelFetch(uSrc, topLeft + ivec2(u, v), 0).r;\nreturn src;\n}\nCharCode closest(Block src) {\nstruct Pair { float diff; int idx; };\nPair closest = Pair(exp(1000.), 0);\nfor (int y = 0; y < Y; y++) {\nfloat diff = 0.;\nfor (int x = 0; x < X; x++)\ndiff += abs(src[x] - texelFetch(uLUT, ivec2(x, y), 0).r);\nif (diff < closest.diff)\nclosest = Pair(diff, y);\n}\nreturn uCharMap[closest.idx];\n}\nvoid main() {\nvOutput = closest(read());\n}\n",H=t=>{t.texParameteri(3553,10241,9728),t.texParameteri(3553,10240,9728)};t.CPURenderer=class extends U{constructor(){super(...arguments),this.l=(()=>{const t=P();return n=>{const[e,r]=y(n),i=t(e,r);return i.drawImage(_(n),0,0),i}})()}*lines(t,e,r){const{settings:i,i:o,s,t:c,l:u}=this,{lutWidth:f,lutHeight:l,gamma:d,signal:v,noise:m}=i,p=f*e,x=l*r,g=u(c(t,p,x)).getImageData(0,0,p,x).data,_=new b(f,l);for(let t=0;x>t;t+=l){const e=[];for(let n=0;p>n;n+=f){let r=0,i=1/0;for(let e=0;l>e;e++)for(let i=0;f>i;i++){let o=n+i+(t+e)*p<<2;const s=(.2126*a(g[o++]/255)+.7152*a(g[o++]/255)+.0722*a(g[o++]/255))**d,c=h()-.5;_[r++]=v*s+m*c}for(let t=s.length;t--;){const n=s[t].compare(_);i>n&&(i=n,r=t)}e.push(o[r])}yield n(...e)}}},t.Context=x,t.GPURenderer=class extends U{constructor(t){super(t),this.h=((t,...n)=>{const e=p("canvas")().getContext("webgl2",t);if(!e)throw Error("WebGL2 is unavailable");for(const t of n)if(!e.getExtension(t))throw Error(`"${t}" extension is unavailable`);return e})({},"EXT_color_buffer_float"),this.v=((t,n=36160)=>{const e=t.createFramebuffer();return B(t,e,e=>t.bindFramebuffer(n,e))})(this.h)(),this.m=A(this.h)(H),this.p=A(this.h)(H),this.g=A(this.h)(H),this._=b.combine(this.s),this.P=new Int32Array;const n=z(this.h,35633,F),e=z(this.h,35632,O),r=z(this.h,35632,((t,n={},e="$")=>Function(`{${Object.keys(n)}}`,e,`return \`${t}\``)(n,n))(T,{chars:this.i.length,width:this.settings.lutWidth,height:this.settings.lutHeight}));var i;this.M=E(this.h,n,e),this.$=E(this.h,n,r),((t,n=34962)=>{const e=t.createBuffer();return B(t,e,e=>t.bindBuffer(n,e))})(this.h)((i=0,t=>{const n=Float32Array.of(1,1,-1,1,1,-1,-1,-1);t.bufferData(34962,n,35044),t.vertexAttribPointer(i,2,5126,!1,0,0),t.enableVertexAttribArray(i)}))}*lines(t,e,r){const{settings:i,i:o,_:s,h:a,t:c}=this,{M:u,$:f,v:l,m:d,p:v,g:m}=this,p=i.lutWidth*e,x=i.lutHeight*r,g=_(c(t,p,x)),y=G(a,u),P=G(a,f),M=e*r;this.P.length!==M&&(this.P=new Int32Array(M)),a.bindFramebuffer(36160,l),a.activeTexture(33986),a.bindTexture(3553,d),a.texImage2D(3553,0,33326,s.width,s.height,0,6403,5126,s),a.activeTexture(33985),a.bindTexture(3553,v),a.texImage2D(3553,0,6408,6408,5121,g),a.activeTexture(33984),a.bindTexture(3553,m),a.texImage2D(3553,0,33326,p,x,0,6403,5126,null),a.framebufferTexture2D(36160,36064,3553,m,0),a.useProgram(u),a.uniform1i(y("uSrc"),1),a.uniform1f(y("uGamma"),i.gamma),a.uniform1f(y("uSignal"),i.signal),a.uniform1f(y("uNoise"),i.noise),a.uniform1f(y("uRandom"),h()),a.viewport(0,0,p,x),a.drawArrays(5,0,4),a.activeTexture(33985),a.bindTexture(3553,m),a.activeTexture(33984),a.bindTexture(3553,v),a.texImage2D(3553,0,33333,p,x,0,36244,5124,null),a.framebufferTexture2D(36160,36064,3553,v,0),a.useProgram(f),a.uniform1i(P("uSrc"),1),a.uniform1i(P("uLUT"),2),a.uniform1iv(P("uCharMap"),o),a.viewport(0,0,e,r),a.drawArrays(5,0,4),a.readPixels(0,0,e,r,36244,5124,this.P),a.bindFramebuffer(36160,null);for(let t=0;M>t;)yield n(...this.P.subarray(t,t+=e))}},t.LUT=b,t.Renderer=U,t.charSets=s,t.defaults=C,t.monospaced=L,Object.defineProperty(t,"S",{value:!0})}));
//# sourceMappingURL=bundle.umd.min.js.map
