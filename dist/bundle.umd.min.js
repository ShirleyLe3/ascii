((t,n)=>{"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).ascii={})})(this,(function(t){"use strict";function*n(t=0,n=1/0,e=1){for(let i=t;n>i;i+=e)yield i}const e=Object.assign,i=(...t)=>(...n)=>e(s("canvas")(...t).getContext("2d"),...n),s=t=>(...n)=>e(document.createElement(t),...n),o=String.fromCharCode,r=t=>t.charCodeAt(0),a=(t,n={},e="$")=>Function(`{${Object.keys(n)}}`,e,`return \`${t}\``)(n,n),h=t=>{const n=i()({font:`1em ${t}`}),e=n.measureText(" ");return t=>n.measureText(t).width===e.width},u=o(...n(32,95),...n(96,127),...n(161,168),...n(174,178),169,171,172,180,181,183,187,191,215,247,...n(8216,8227),8249,8250,8729,8730,8734),l=u.replace(/[^\x00-\xff]/g,""),c=u.replace(/[^\x00-\x7f]/g,""),f={__proto__:null,unicode:u,extended:l,ascii:c},d=t=>t>.04045?((t+.055)/1.055)**2.4:t/12.92,{abs:v,clz32:m,floor:p,max:x,random:g,round:_}=Math,y=t=>1<<x(0,31-m(t)),w=(t,n,e)=>{const s=(t=>t instanceof CanvasRenderingContext2D?t.canvas:t)(t);let o=n*y(s.width/n-1),r=e*y(s.height/e-1);const a=i({width:o,height:r})();if(a.drawImage(s,0,0,o,r),n===o&&e===r)return a;for(let t,i;t=o>n,i=r>e,t||i;)a.drawImage(a.canvas,0,0,o,r,0,0,o>>=+t,r>>=+i);const h=i({width:n,height:e})();return h.drawImage(a.canvas,0,0),h};class b extends Float32Array{constructor(t,n){super(t*n),this.width=t,this.height=n}static fromCharCode(t,n){const{fontWidth:e,fontHeight:s,fontFamily:r,fontBlur:a,fontGamma:h}=n,{fontBase:u,lutWidth:l,lutHeight:c,lutPadding:f,lutGamma:v}=n,m=2*f+l,p=2*f+c,x=_(m/l*e),g=_(p/c*s),y=i({width:x,height:g})(),$=o(t);y.fillStyle="#00f",y.fillRect(0,0,x,g),y.translate(x/2,g/2),y.fillStyle="#000",y.fillRect(-e/2,-s/2,e,s),y.translate(0,s*(.5-u)),y.fillStyle="#fff",y.textAlign="center",y.font=`${s}px ${r}`;for(let t=0,n=1,e=1;a>t;[n,e]=[e,e+n])y.filter=`blur(${e}px)`,y.globalAlpha=(++t/a)**h,y.fillText($,0,0);const M=new b(l,c),F=w(y,m,p).getImageData(f,f,l,c).data;for(let t=0;M.length>t;t++)M[t]=d(F[t<<2]/255)**v;return M}static combine(t){const n=t[0].length,e=t.length,i=new b(n,e);for(let s=0;e>s;s++)i.set(t[s],s*n);return i}normalize(t,n){for(let e=0;this.length>e;e++)this[e]=(this[e]-t)/(n-t)}compare(t){let n=0;for(let e=this.length;e--;)n+=v(this[e]-t[e]);return n}}class ${constructor(){this.charSet=c,this.fontFamily="monospace",this.fontBase=.25,this.fontWidth=40,this.fontHeight=70,this.fontBlur=9,this.fontGamma=1,this.lutWidth=5,this.lutHeight=7,this.lutPadding=1,this.lutMin=0,this.lutMax=1,this.lutGamma=1,this.brightness=1,this.gamma=1,this.noise=0}}class M{constructor(t){this.settings=new $,e(this.settings,t),this.t=this.i(),this.s=this.o()}i(){const{charSet:t,fontFamily:n}=this.settings,e=[...t].filter(h(n)).map(r);return Int32Array.from(e)}o(){const{t,settings:n}=this,{lutMin:e,lutMax:i}=n,s=Array.from(t,t=>b.fromCharCode(t,n)),o=s.reduce((t,n)=>x(t,...n),0);for(const t of s)t.normalize(e*o,i*o);return s}render(t,n,e){return[...this.lines(t,p(n),p(e))].join("\n")}}const F=5,P=5121,C=5126,S=6408,U=35632,R=35633,A=3553,G=33984,L=36160,B=36064,z=6403,E=33326,T=(t,...n)=>{const e=s("canvas")().getContext("webgl2",t);if(!e)throw Error("WebGL2 is not available");for(const t of n)if(!e.getExtension(t))throw Error(`"${t}" extension is not available`);return e},X=(t,n,e)=>{const i=`#version 300 es\n${e}`,s=t.createShader(n);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,35713))throw Error(`Shader error:\n${t.getShaderInfoLog(s)}\n${N(i)}\n`);return s},j=(t,n,e)=>{const i=t.createProgram();if(t.attachShader(i,n),t.attachShader(i,e),t.linkProgram(i),!t.getProgramParameter(i,35714))throw Error(`Program error: ${t.getProgramInfoLog(i)}`);return i},D=(t,n=34962)=>{const e=t.createBuffer();return V(t,e,e=>t.bindBuffer(n,e))},O=(t,n=A)=>{const e=t.createTexture();return V(t,e,e=>t.bindTexture(n,e))},W=(t,n=L)=>{const e=t.createFramebuffer();return V(t,e,e=>t.bindFramebuffer(n,e))},H=(t,n)=>e=>t.getUniformLocation(n,e),N=(t,n=1)=>t.replace(/^/gm,()=>`${n++}: `.padStart(5,"0")),V=(t,n,e)=>i=>(i&&(e(n),i(t,n),e(null)),n),Y="in vec2 aPosition;\nout vec2 vPosition;\nvoid main() {\nvPosition = 0.5 + 0.5*aPosition;\ngl_Position = vec4(aPosition, 0., 1.);\n}\n",k="#define MAP3(f, v) vec3(f(v.x), f(v.y), f(v.z))\n#define RGB(x) mix(x/12.92, pow((x+.055)/1.055, 2.4), step(.04045, x))\n#define LUM(x) dot(x, vec3(.2126, .7152, .0722))\nprecision mediump float;\nuniform sampler2D uSrc;\nuniform float uBrightness;\nuniform float uGamma;\nuniform float uNoise;\nuniform float uRandom;\nin vec2 vPosition;\nout vec4 vFragColor;\nfloat hash13(vec3 p3) {\np3 = fract(p3 * 0.1031);\np3 += dot(p3, p3.yzx + 19.19);\nreturn fract((p3.x + p3.y) * p3.z);\n}\nvoid main() {\nvec3 srgb = texture(uSrc, vPosition).rgb;\nfloat signal = uBrightness * pow(LUM(MAP3(RGB, srgb)), uGamma);\nfloat noise = uNoise * (hash13(vec3(gl_FragCoord.xy, 1000.*uRandom)) - 0.5);\nvFragColor = vec4(vec3(clamp(signal + noise, 0., 1.)), 0.);\n}\n",I="#define U ${ width }\n#define V ${ height }\n#define X ${ width * height }\n#define Y ${ chars }\nprecision mediump float;\nuniform sampler2D uSrc;\nuniform sampler2D uLUT;\nuniform int uCharMap[Y];\nin vec2 vPosition;\nout vec4 vFragColor;\nstruct Result {\nint index;\nfloat value;\n};\nvoid main() {\nResult res = Result(0, float(X));\nivec2 pos = ivec2(vec2(textureSize(uSrc, 0))*vPosition) - ivec2(U, V)/2;\nfloat src[X];\nfor (int v = 0; v < V; v++)\nfor (int u = 0; u < U; u++)\nsrc[u + v*U] = texelFetch(uSrc, pos + ivec2(u, v), 0).r;\nfor (int y = 0; y < Y; y++) {\nfloat value = 0.;\nfor (int x = 0; x < X; x++)\nvalue += abs(src[x] - texelFetch(uLUT, ivec2(x, y), 0).r);\nif (res.value > value)\nres = Result(y, value);\n}\nvFragColor = vec4(uCharMap[res.index], 0, 0, 0);\n}\n",q=t=>{t.texParameteri(A,10241,9728),t.texParameteri(A,10240,9728)},J=t=>n=>{const e=Float32Array.of(1,1,-1,1,1,-1,-1,-1);n.bufferData(34962,e,35044),n.vertexAttribPointer(t,2,C,!1,0,0),n.enableVertexAttribArray(t)};t.CPURenderer=class extends M{*lines(t,n,e){const{settings:i,t:s,s:r}=this,{lutWidth:a,lutHeight:h,brightness:u,gamma:l,noise:c}=i,f=a*n,v=h*e,m=w(t,f,v).getImageData(0,0,f,v).data,p=new Float32Array(a*h);for(let t=0;v>t;t+=h){const n=[];for(let e=0;f>e;e+=a){let i=0,o=1/0;for(let n=0;h>n;n++)for(let s=0;a>s;s++){let o=e+s+(t+n)*f<<2;const r=u*(.2126*d(m[o++]/255)+.7152*d(m[o++]/255)+.0722*d(m[o++]/255))**l,a=c*(g()-.5);p[i++]=r+a}for(let t=r.length;t--;){const n=r[t].compare(p);o>n&&(o=n,i=t)}n.push(s[i])}yield o(...n)}}},t.GPURenderer=class extends M{constructor(t){super(t),this.h=T({},"EXT_color_buffer_float"),this.u=W(this.h)(),this.l=O(this.h)(q),this.v=O(this.h)(q),this.m=O(this.h)(q),this.p=b.combine(this.s),this.g=new Float32Array;const n=X(this.h,R,Y),e=X(this.h,U,k),i=X(this.h,U,a(I,{chars:this.t.length,width:this.settings.lutWidth,height:this.settings.lutHeight}));this._=j(this.h,n,e),this.$=j(this.h,n,i),D(this.h)(J(0))}*lines(t,n,e){const{settings:i,t:s,p:r,h:a,_:h,$:u,u:l,l:c,v:f,m:d}=this,v=i.lutWidth*n,m=i.lutHeight*e,p=w(t,v,m),x=H(a,h),g=H(a,u);this.g.length!==n*e&&(this.g=new Float32Array(n*e)),a.bindFramebuffer(L,l),a.activeTexture(G+2),a.bindTexture(A,c),a.texImage2D(A,0,E,r.width,r.height,0,z,C,r),a.activeTexture(G+1),a.bindTexture(A,f),a.texImage2D(A,0,S,S,P,p.canvas),a.activeTexture(G+0),a.bindTexture(A,d),a.texImage2D(A,0,E,v,m,0,z,C,null),a.framebufferTexture2D(L,B,A,d,0),a.useProgram(h),a.uniform1i(x("uSrc"),1),a.uniform1f(x("uBrightness"),i.brightness),a.uniform1f(x("uGamma"),i.gamma),a.uniform1f(x("uNoise"),i.noise),a.uniform1f(x("uRandom"),Math.random()),a.viewport(0,0,v,m),a.drawArrays(F,0,4),a.activeTexture(G+1),a.bindTexture(A,d),a.activeTexture(G+0),a.bindTexture(A,f),a.texImage2D(A,0,E,v,m,0,z,C,null),a.framebufferTexture2D(L,B,A,f,0),a.useProgram(u),a.uniform1i(g("uSrc"),1),a.uniform1i(g("uLUT"),2),a.uniform1iv(g("uCharMap"),s),a.viewport(0,0,n,e),a.drawArrays(F,0,4),a.readPixels(0,0,n,e,z,C,this.g),a.bindFramebuffer(L,null);for(let t=0;this.g.length>t;)yield o(...this.g.subarray(t,t+=n))}},t.LUT=b,t.Renderer=M,t.Settings=$,t.charSets=f,Object.defineProperty(t,"M",{value:!0})}));
//# sourceMappingURL=bundle.umd.min.js.map
