((t,n)=>{"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).ascii={})})(this,(function(t){"use strict";const n=String.fromCharCode,e=t=>t.charCodeAt(0),r=t=>{const[r,o]=[...t].map(e),s=[...Array(o-r).keys()].map(t=>r+t);return n(...s,o)},o=r(" ^")+r("`~"),s=o+r("¡§")+"®°±©«¬´µ·»¿×÷",i={__proto__:null,ascii:o,extended:s,extra:s+r("‘•")+"‹›∙√∞"},a=t=>t>.04045?((t+.055)/1.055)**2.4:t/12.92,{abs:u,clz32:c,floor:l,max:h,random:f,round:v}=Math,d=Object.assign,m=d,p=OffscreenCanvasRenderingContext2D,g=(t,n)=>d([t,n,t/n],{width:t,height:n,ratio:t/n}),x=t=>t instanceof p?t.canvas:t,_=t=>{if(t instanceof HTMLVideoElement)return g(t.videoWidth,t.videoHeight);if(t instanceof HTMLImageElement)return g(t.naturalWidth,t.naturalHeight);const n=x(t);return g(n.width,n.height)},y=t=>{const n=new OffscreenCanvas(0,0),e=n.getContext("2d");return(r,o)=>{var s;return m(n,{width:r,height:o}),null===(s=t)||void 0===s||s(e),e}},b=t=>1<<h(0,31-c(t)),M=()=>{const t=(()=>{const t=y();return(n,e,r)=>{const o=t(e,r);return o.drawImage(x(n),0,0,e,r),o}})(),n=(()=>{const t=y();return(n,e,r,o,s)=>{const i=t(o,s);return i.drawImage(x(n),e,r,o,s,0,0,o,s),i}})();return(e,r,o)=>{const[s,i]=_(e);let a=r*b(s/r-1),u=o*b(i/o-1);const c=t(e,a,u);if(r===a&&o===u)return c;for(let t,n;t=a>r,n=u>o,t||n;)c.drawImage(c.canvas,0,0,a,u,0,0,a>>=+t,u>>=+n);return n(c,0,0,r,o)}},w=y(),$=M();class F extends Float32Array{constructor(t,n){super(t*n),this.width=t,this.height=n}static fromCharCode(t,e){const{fontWidth:r,fontHeight:o,fontFamily:s,fontBlur:i,fontGamma:u}=e,{fontBase:c,lutWidth:l,lutHeight:h,lutPadding:f,lutGamma:d}=e,m=2*f+l,p=2*f+h,g=v(m/l*r),x=v(p/h*o),_=w(g,x),y=n(t);_.fillStyle="#00f",_.fillRect(0,0,g,x),_.translate(g/2,x/2),_.fillStyle="#000",_.fillRect(-r/2,-o/2,r,o),_.translate(0,o*(.5-c)),_.fillStyle="#fff",_.textAlign="center",_.font=`${o}px ${s}`;for(let t=0,n=1,e=1;i>t;[n,e]=[e,e+n])_.filter=`blur(${e}px)`,_.globalAlpha=(++t/i)**u,_.fillText(y,0,0);const b=new F(l,h),M=$(_,m,p).getImageData(f,f,l,h).data;for(let t=0;b.length>t;t++)b[t]=a(M[t<<2]/255)**d;return b}static combine(t){const n=t[0].length,e=t.length,r=new F(n,e);for(let o=0;e>o;o++)r.set(t[o],o*n);return r}normalize(t,n){for(let e=this.length;e--;)this[e]=(this[e]-t)/(n-t)}compare(t){let n=0;for(let e=this.length;e--;)n+=u(this[e]-t[e]);return n}}const P={charSet:o,fontFamily:"monospace",fontBase:.25,fontWidth:40,fontHeight:70,fontBlur:9,fontGamma:1,lutWidth:5,lutHeight:7,lutPadding:1,lutMin:0,lutMax:1,lutGamma:1,brightness:1,gamma:1,noise:0},C=t=>{const n=y(n=>n.font=`1em ${t}`)(0,0),e=n.measureText(" ");return t=>n.measureText(t).width===e.width};class S{constructor(t){this.t=(()=>{const t=M();return(n,e,r)=>{const[o,s]=_(n);return e!==o||r!==s?t(n,e,r):n}})(),this.settings={...P,...t},this.o=this.s(),this.i=this.u()}s(){const{charSet:t,fontFamily:n}=this.settings,r=[...t].filter(C(n)).map(e);return Int32Array.from(r)}u(){const{o:t,settings:n}=this,{lutMin:e,lutMax:r}=n,o=Array.from(t,t=>F.fromCharCode(t,n)),s=o.reduce((t,n)=>h(t,...n),0);for(const t of o)t.normalize(e*s,r*s);return o}render(t,n,e){return[...this.lines(t,l(n),l(e))].join("\n")}}const U=(t,...n)=>{var e;const r=(e="canvas",(...t)=>m(document.createElement(e),...t))().getContext("webgl2",t);if(!r)throw Error("WebGL2 is not available");for(const t of n)if(!r.getExtension(t))throw Error(`"${t}" extension is not available`);return r},G=(t,n,e)=>{const r=`#version 300 es\n${e}`,o=t.createShader(n);if(t.shaderSource(o,r),t.compileShader(o),!t.getShaderParameter(o,35713))throw Error(`Shader error:\n${t.getShaderInfoLog(o)}\n${B(r)}\n`);return o},L=(t,n,e)=>{const r=t.createProgram();if(t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),!t.getProgramParameter(r,35714))throw Error(`Program error: ${t.getProgramInfoLog(r)}`);return r},R=(t,n=3553)=>{const e=t.createTexture();return z(t,e,e=>t.bindTexture(n,e))},A=(t,n)=>e=>t.getUniformLocation(n,e),B=(t,n=1)=>t.replace(/^/gm,()=>`${n++}: `.padStart(5,"0")),z=(t,n,e)=>r=>(r&&(e(n),r(t,n),e(null)),n),E="in vec2 aPosition;\nout vec2 vPosition;\nvoid main() {\nvPosition = 0.5 + 0.5*aPosition;\ngl_Position = vec4(aPosition, 0., 1.);\n}\n",T="#define MAP3(f, v) vec3(f(v.x), f(v.y), f(v.z))\n#define RGB(x) mix(x/12.92, pow((x+.055)/1.055, 2.4), step(.04045, x))\n#define LUM(x) dot(x, vec3(.2126, .7152, .0722))\nprecision highp float;\nuniform sampler2D uSrc;\nuniform float uBrightness;\nuniform float uGamma;\nuniform float uNoise;\nuniform float uRandom;\nin vec2 vPosition;\nout vec4 vFragColor;\nfloat hash13(vec3 p3) {\np3 = fract(p3 * 0.1031);\np3 += dot(p3, p3.yzx + 19.19);\nreturn fract((p3.x + p3.y) * p3.z);\n}\nvoid main() {\nvec3 srgb = texture(uSrc, vPosition).rgb;\nfloat signal = uBrightness * pow(LUM(MAP3(RGB, srgb)), uGamma);\nfloat noise = uNoise * (hash13(vec3(gl_FragCoord.xy, 1000.*uRandom)) - 0.5);\nvFragColor = vec4(vec3(clamp(signal + noise, 0., 1.)), 0.);\n}\n",H="#define U ${ width }\n#define V ${ height }\n#define X ${ width * height }\n#define Y ${ chars }\nprecision highp float;\nuniform sampler2D uSrc;\nuniform sampler2D uLUT;\nuniform int uCharMap[Y];\nin vec2 vPosition;\nout vec4 vFragColor;\nstruct Result {\nint index;\nfloat value;\n};\nvoid main() {\nResult res = Result(0, float(X));\nivec2 pos = ivec2(vec2(textureSize(uSrc, 0))*vPosition) - ivec2(U, V)/2;\nfloat src[X];\nfor (int v = 0; v < V; v++)\nfor (int u = 0; u < U; u++)\nsrc[u + v*U] = texelFetch(uSrc, pos + ivec2(u, v), 0).r;\nfor (int y = 0; y < Y; y++) {\nfloat value = 0.;\nfor (int x = 0; x < X; x++)\nvalue += abs(src[x] - texelFetch(uLUT, ivec2(x, y), 0).r);\nif (res.value > value)\nres = Result(y, value);\n}\nvFragColor = vec4(uCharMap[res.index], 0, 0, 0);\n}\n",O=t=>{t.texParameteri(3553,10241,9728),t.texParameteri(3553,10240,9728)};t.CPURenderer=class extends S{constructor(){super(...arguments),this.l=(()=>{const t=y();return n=>{const[e,r]=_(n),o=t(e,r);return o.drawImage(x(n),0,0),o}})()}*lines(t,e,r){const{settings:o,o:s,i,t:u,l:c}=this,{lutWidth:l,lutHeight:h,brightness:v,gamma:d,noise:m}=o,p=l*e,g=h*r,x=c(u(t,p,g)).getImageData(0,0,p,g).data,_=new F(l,h);for(let t=0;g>t;t+=h){const e=[];for(let n=0;p>n;n+=l){let r=0,o=1/0;for(let e=0;h>e;e++)for(let o=0;l>o;o++){let s=n+o+(t+e)*p<<2;const i=v*(.2126*a(x[s++]/255)+.7152*a(x[s++]/255)+.0722*a(x[s++]/255))**d,u=m*(f()-.5);_[r++]=i+u}for(let t=i.length;t--;){const n=i[t].compare(_);o>n&&(o=n,r=t)}e.push(s[r])}yield n(...e)}}},t.Context=p,t.GPURenderer=class extends S{constructor(t){super(t),this.h=U({},"EXT_color_buffer_float"),this.v=((t,n=36160)=>{const e=t.createFramebuffer();return z(t,e,e=>t.bindFramebuffer(n,e))})(this.h)(),this.m=R(this.h)(O),this.p=R(this.h)(O),this.g=R(this.h)(O),this._=F.combine(this.i),this.M=new Float32Array;const n=G(this.h,35633,E),e=G(this.h,35632,T),r=G(this.h,35632,((t,n={},e="$")=>Function(`{${Object.keys(n)}}`,e,`return \`${t}\``)(n,n))(H,{chars:this.o.length,width:this.settings.lutWidth,height:this.settings.lutHeight}));var o;this.$=L(this.h,n,e),this.F=L(this.h,n,r),((t,n=34962)=>{const e=t.createBuffer();return z(t,e,e=>t.bindBuffer(n,e))})(this.h)((o=0,t=>{const n=Float32Array.of(1,1,-1,1,1,-1,-1,-1);t.bufferData(34962,n,35044),t.vertexAttribPointer(o,2,5126,!1,0,0),t.enableVertexAttribArray(o)}))}*lines(t,e,r){const{settings:o,o:s,_:i,h:a,t:u}=this,{$:c,F:l,v:h,m:v,p:d,g:m}=this,p=o.lutWidth*e,g=o.lutHeight*r,_=x(u(t,p,g)),y=A(a,c),b=A(a,l),M=e*r,w=M<<2;this.M.length!==w&&(this.M=new Float32Array(w)),a.bindFramebuffer(36160,h),a.activeTexture(33986),a.bindTexture(3553,v),a.texImage2D(3553,0,33326,i.width,i.height,0,6403,5126,i),a.activeTexture(33985),a.bindTexture(3553,d),a.texImage2D(3553,0,6408,6408,5121,_),a.activeTexture(33984),a.bindTexture(3553,m),a.texImage2D(3553,0,33326,p,g,0,6403,5126,null),a.framebufferTexture2D(36160,36064,3553,m,0),a.useProgram(c),a.uniform1i(y("uSrc"),1),a.uniform1f(y("uBrightness"),o.brightness),a.uniform1f(y("uGamma"),o.gamma),a.uniform1f(y("uNoise"),o.noise),a.uniform1f(y("uRandom"),f()),a.viewport(0,0,p,g),a.drawArrays(5,0,4),a.activeTexture(33985),a.bindTexture(3553,m),a.activeTexture(33984),a.bindTexture(3553,d),a.texImage2D(3553,0,33326,p,g,0,6403,5126,null),a.framebufferTexture2D(36160,36064,3553,d,0),a.useProgram(l),a.uniform1i(b("uSrc"),1),a.uniform1i(b("uLUT"),2),a.uniform1iv(b("uCharMap"),s),a.viewport(0,0,e,r),a.drawArrays(5,0,4),a.readPixels(0,0,e,r,6408,5126,this.M),a.bindFramebuffer(36160,null);for(let t=0;M>t;t++)this.M[t]=this.M[t<<2];for(let t=0;M>t;)yield n(...this.M.subarray(t,t+=e))}},t.LUT=F,t.Renderer=S,t.charSets=i,t.defaults=P,t.monospaced=C,Object.defineProperty(t,"P",{value:!0})}));
//# sourceMappingURL=bundle.umd.min.js.map
