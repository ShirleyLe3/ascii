((t,n)=>{"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).ascii={})})(this,(function(t){"use strict";const n=String.fromCharCode,e=t=>t.charCodeAt(0),r=Object.assign,i=r,o=t=>{const[r,i]=[...t].map(e),o=[...Array(i-r).keys()].map(t=>r+t);return n(...o,i)},s=o(" ^")+o("`~"),a=s+o("¡§")+"®°±©«¬´µ·»¿×÷",c={__proto__:null,ascii:s,extended:a,extra:a+o("‘•")+"‹›∙√∞"},u=CanvasRenderingContext2D,f=(l="canvas",(...t)=>i(document.createElement(l),...t));var l;const h=(t,n)=>r([t,n,t/n],{width:t,height:n,ratio:t/n}),d=t=>t instanceof u?t.canvas:t,v=t=>{if(t instanceof HTMLVideoElement)return h(t.videoWidth,t.videoHeight);if(t instanceof HTMLImageElement)return h(t.naturalWidth,t.naturalHeight);const n=d(t);return h(n.width,n.height)},m=t=>{const n=f().getContext("2d");return(e,r)=>{var o;return i(n.canvas,{width:e,height:r}),null===(o=t)||void 0===o||o(n),n}},{abs:p,clz32:x,floor:g,max:_,random:y,round:P}=Math,M=(t,n,e)=>.2126*t+.7152*n+.0722*e,w=t=>t>.04045?((t+.055)/1.055)**2.4:t/12.92,$=t=>1<<_(0,31-x(t)),S=()=>{const t=(()=>{const t=m();return(n,e,r)=>{const i=t(e,r);return i.drawImage(d(n),0,0,e,r),i}})(),n=(()=>{const t=m();return(n,e,r,i=0,o=0)=>{const s=t(e,r);return s.drawImage(d(n),i,o,e,r,0,0,e,r),s}})();return(e,r,i)=>{const[o,s]=v(e);let a=r*$(o/r-1),c=i*$(s/i-1);const u=t(e,a,c);if(r===a&&i===c)return u;for(let t,n;t=a>r,n=c>i,t||n;)u.drawImage(u.canvas,0,0,a,c,0,0,a>>=+t,c>>=+n);return n(u,r,i)}},b=m(),C=S();class L extends Float32Array{constructor(t,n){super(t*n),this.width=t,this.height=n}static fromCharCode(t,e){const{fontWidth:r,fontHeight:i,fontFamily:o,fontBlur:s,fontGamma:a}=e,{fontBase:c,lutWidth:u,lutHeight:f,lutPadding:l,lutGamma:h}=e,d=2*l+u,v=2*l+f,m=P(d/u*r),p=P(v/f*i),x=b(m,p),g=n(t);x.fillStyle="#00f",x.fillRect(0,0,m,p),x.translate(m/2,p/2),x.fillStyle="#000",x.fillRect(-r/2,-i/2,r,i),x.translate(0,i*(.5-c)),x.fillStyle="#fff",x.textAlign="center",x.font=`${i}px ${o}`;for(let t=0,n=1,e=1;s>t;[n,e]=[e,e+n])x.filter=`blur(${e}px)`,x.globalAlpha=(++t/s)**a,x.fillText(g,0,0);const _=new L(u,f),y=C(x,d,v).getImageData(l,l,u,f).data;for(let t=0;_.length>t;t++)_[t]=w(y[t<<2]/255)**h;return _}static combine(t){const n=t[0].length,e=t.length,r=new L(n,e);for(let i=0;e>i;i++)r.set(t[i],i*n);return r}normalize(t,n){for(let e=this.length;e--;)this[e]=(this[e]-t)/(n-t)}compare(t){let n=0;for(let e=this.length;e--;)n+=p(this[e]-t[e]);return n}}const U={charSet:s,fontFamily:"monospace",fontBase:.25,fontWidth:40,fontHeight:70,fontBlur:9,fontGamma:1,lutWidth:5,lutHeight:7,lutPadding:1,lutMin:0,lutMax:1,lutGamma:1,gamma:1,signal:1,noise:0},B=t=>{const n=m(n=>n.font=`1em ${t}`)(0,0),e=n.measureText(" ");return t=>n.measureText(t).width===e.width};class G{constructor(t){this.t=(()=>{const t=S();return(n,e,r)=>{const[i,o]=v(n);return e!==i||r!==o?t(n,e,r):n}})(),this.settings={...U,...t},this.i=this.o(),this.s=this.u()}o(){const{charSet:t,fontFamily:n}=this.settings,r=[...t].filter(B(n)).map(e);return Int32Array.from(r)}u(){const{i:t,settings:n}=this,{lutMin:e,lutMax:r}=n,i=Array.from(t,t=>L.fromCharCode(t,n)),o=i.reduce((t,n)=>_(t,...n),0);for(const t of i)t.normalize(e*o,r*o);return i}render(t,n,e){return[...this.l(t,g(n),g(e))].join("\n")}}const A=(t,n,e)=>r=>(r&&(e(n),r(t,n),e(null)),n),z=(t,n)=>e=>t.getUniformLocation(n,e),E=(t,n=3553)=>{const e=t.createTexture();return A(t,e,e=>t.bindTexture(n,e))},F=(t,n,e)=>{const r=`#version 300 es\n${e}`,i=t.createShader(n);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,35713)){const n=t.getShaderInfoLog(i);throw Error(`Shader error:\n${n}\n${((t,n=1)=>t.replace(/^/gm,()=>`${n++}: `.padStart(5,"0")))(r)}\n`)}return i},O=(t,n,e)=>{const r=t.createProgram();if(t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),!t.getProgramParameter(r,35714)){const n=t.getProgramInfoLog(r);throw Error(`Program error: ${n}`)}return r},T="in vec2 aPosition;out vec2 vPosition;void main(){vPosition=.5+.5*aPosition;gl_Position=vec4(aPosition,0.,1.);}",H="#define MAP3(fn,v3)vec3(fn(v3.x),fn(v3.y),fn(v3.z))\n#define RGB(v1)mix(v1/12.92,pow((v1+.055)/1.055,2.4),step(.04045,v1))\n#define LUM(v3)dot(MAP3(RGB,v3),vec3(.2126,.7152,.0722))\nprecision highp float;uniform sampler2D uSrc;uniform float uGamma;uniform float uSignal;uniform float uNoise;uniform float uRandom;in vec2 vPosition;out float vOutput;float hash13(vec3 p3){p3=fract(p3*1031.);p3+=dot(p3,p3.yzx+19.19);return fract((p3.x+p3.y)*p3.z);}void main(){vec4 t=texture(uSrc,vPosition);float s=pow(LUM(t),uGamma);float n=hash13(vec3(vPosition,uRandom))-0.5;vOutput=uSignal*s+uNoise*n;}",k="#define U ${width}\n#define V ${height}\n#define X ${width*height}\n#define Y ${chars}\n#define Inf exp(1000.)\n#define Block float[X]\n#define CharCode int\nprecision highp float;uniform sampler2D uSrc;uniform sampler2D uLUT;uniform int uCharMap[Y];in vec2 vPosition;out int vOutput;Block read(){vec2 center=vec2(textureSize(uSrc,0))*vPosition;ivec2 topLeft=ivec2(center+.25)-ivec2(U,V)/2;Block src;for(int v=0;v<V;v++)for(int u=0;u<U;u++)src[u+v*U]=texelFetch(uSrc,topLeft+ivec2(u,v),0).r;return src;}CharCode closest(Block src){struct Pair{float diff;int idx;};Pair closest=Pair(Inf,0);for(int y=0;y<Y;y++){float diff=0.;for(int x=0;x<X;x++)diff+=abs(src[x]-texelFetch(uLUT,ivec2(x,y),0).r);if(closest.diff>diff)closest=Pair(diff,y);}return uCharMap[closest.idx];}void main(){vOutput=closest(read());}",I=t=>{t.texParameteri(3553,10241,9728),t.texParameteri(3553,10240,9728)};t.CPURenderer=class extends G{constructor(){super(...arguments),this.h=(()=>{const t=m();return n=>{const[e,r]=v(n),i=t(e,r);return i.drawImage(d(n),0,0),i}})()}*l(t,e,r){const{settings:i,i:o,s,t:a,h:c}=this,{lutWidth:u,lutHeight:f,gamma:l,signal:h,noise:d}=i,v=u*e,m=f*r,p=c(a(t,v,m)).getImageData(0,0,v,m).data,x=new L(u,f);for(let t=0;m>t;t+=f){const e=[];for(let n=0;v>n;n+=u){let r=0,i=1/0;for(let e=0;f>e;e++)for(let i=0;u>i;i++){let o=n+i+(t+e)*v<<2;const s=w(p[o++]/255),a=w(p[o++]/255),c=w(p[o++]/255),u=M(s,a,c)**l,f=y()-.5;x[r++]=h*u+d*f}for(let t=s.length;t--;){const n=s[t].compare(x);i>n&&(i=n,r=t)}e.push(o[r])}yield n(...e)}}},t.Context=u,t.GPURenderer=class extends G{constructor(t){super(t),this.v=((t,...n)=>{const e=f().getContext("webgl2",t);if(!e)throw Error("WebGL2 is unavailable");for(const t of n)if(!e.getExtension(t))throw Error(`"${t}" extension is unavailable`);return e})({},"EXT_color_buffer_float"),this.m=((t,n=36160)=>{const e=t.createFramebuffer();return A(t,e,e=>t.bindFramebuffer(n,e))})(this.v)(),this.p=E(this.v)(I),this.g=E(this.v)(I),this._=E(this.v)(I),this.P=L.combine(this.s),this.M=new Int32Array;const n=F(this.v,35633,T),e=F(this.v,35632,H),r=F(this.v,35632,((t,n={},e="$")=>Function(`{${Object.keys(n)}}`,e,`return \`${t}\``)(n,n))(k,{chars:this.i.length,width:this.settings.lutWidth,height:this.settings.lutHeight}));var i;this.$=O(this.v,n,e),this.S=O(this.v,n,r),((t,n=34962)=>{const e=t.createBuffer();return A(t,e,e=>t.bindBuffer(n,e))})(this.v)((i=0,t=>{const n=Float32Array.of(1,1,-1,1,1,-1,-1,-1);t.bufferData(34962,n,35044),t.vertexAttribPointer(i,2,5126,!1,0,0),t.enableVertexAttribArray(i)}))}*l(t,e,r){const{settings:i,i:o,P:s,v:a,t:c}=this,{$:u,S:f,m:l,p:h,g:v,_:m}=this,p=i.lutWidth*e,x=i.lutHeight*r,g=d(c(t,p,x)),_=z(a,u),P=z(a,f),M=e*r;this.M.length!==M&&(this.M=new Int32Array(M)),a.bindFramebuffer(36160,l),a.activeTexture(33986),a.bindTexture(3553,h),a.texImage2D(3553,0,33326,s.width,s.height,0,6403,5126,s),a.activeTexture(33985),a.bindTexture(3553,v),a.texImage2D(3553,0,6408,6408,5121,g),a.activeTexture(33984),a.bindTexture(3553,m),a.texImage2D(3553,0,33326,p,x,0,6403,5126,null),a.framebufferTexture2D(36160,36064,3553,m,0),a.useProgram(u),a.uniform1i(_("uSrc"),1),a.uniform1f(_("uGamma"),i.gamma),a.uniform1f(_("uSignal"),i.signal),a.uniform1f(_("uNoise"),i.noise),a.uniform1f(_("uRandom"),y()),a.viewport(0,0,p,x),a.drawArrays(5,0,4),a.activeTexture(33985),a.bindTexture(3553,m),a.activeTexture(33984),a.bindTexture(3553,v),a.texImage2D(3553,0,33333,p,x,0,36244,5124,null),a.framebufferTexture2D(36160,36064,3553,v,0),a.useProgram(f),a.uniform1i(P("uSrc"),1),a.uniform1i(P("uLUT"),2),a.uniform1iv(P("uCharMap"),o),a.viewport(0,0,e,r),a.drawArrays(5,0,4),a.readPixels(0,0,e,r,36244,5124,this.M),a.bindFramebuffer(36160,null);for(let t=0;M>t;)yield n(...this.M.subarray(t,t+=e))}},t.LUT=L,t.Renderer=G,t.charSets=c,t.defaults=U,t.monospaced=B,Object.defineProperty(t,"C",{value:!0})}));
//# sourceMappingURL=bundle.umd.min.js.map
