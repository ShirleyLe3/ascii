{"version":3,"file":"ascii.min.js","sources":["../../node_modules/wheels/esm/color/srgb.js","../../node_modules/wheels/esm/math/native.js","../../node_modules/wheels/esm/fp/iter.js","../../node_modules/wheels/esm/object/index.js","../../node_modules/wheels/esm/dom/index.js","../../node_modules/wheels/esm/text/template.js","../../src/classes/Shader.ts","../../src/classes/shaders/Setup.ts","../../src/classes/shaders/Pass1.ts","../../src/classes/shaders/Pass2.ts","../../src/classes/Renderer.ts","../../src/classes/ASCIICoreSettings.ts","../../src/classes/ASCIISettings.ts","../../src/downscale.ts","../../src/classes/ASCII.ts"],"sourcesContent":["export const rgb = (srgb) => srgb <= 0.04045 ? srgb / 12.92 : ((srgb + 0.055) / 1.055) ** 2.4;\nexport const srgb = (rgb) => rgb <= 0.0031308 ? rgb * 12.92 : (rgb ** (1 / 2.4)) * 1.055 - 0.055;\n","export const { abs, acos, acosh, asin, asinh, atan, atan2, atanh, cbrt, ceil, clz32, cos, cosh, exp, expm1, floor, fround, hypot, imul, log, log10, log1p, log2, max, min, pow, random, round, sign, sin, sinh, sqrt, tan, tanh, trunc, E, LN10, LN2, LOG10E, LOG2E, PI, SQRT1_2, SQRT2 } = Math;\nexport const { isFinite, isInteger, isNaN, isSafeInteger, parseFloat, parseInt, EPSILON, MAX_SAFE_INTEGER, MAX_VALUE, MIN_SAFE_INTEGER, MIN_VALUE, NEGATIVE_INFINITY, POSITIVE_INFINITY } = Number;\n","export const filter = (fn) => function* (it) {\n    for (const value of it)\n        if (fn(value))\n            yield value;\n};\nexport const map = (fn) => function* (it) {\n    for (const value of it)\n        yield fn(value);\n};\nexport const reduce = (fn) => (acc) => (it) => {\n    let acc聞 = acc;\n    for (const value of it)\n        acc聞 = fn(acc聞, value);\n    return acc聞;\n};\nexport const range = function* (min, max, step = 1) {\n    for (let number = min; number < max; number += step)\n        yield number;\n};\nexport const matcher = (re) => function* (input) {\n    for (let match; match = re.exec(input);)\n        yield match;\n};\n","export const extend = Object.assign;\nexport const overwrite = extend;\nexport const copy = (object) => overwrite({}, object);\nexport const get = (object, path, sep = '.') => path.split(sep).reduce((o, next) => o && o[next], object);\nexport const proto = (object) => {\n    const props = new Set();\n    for (let o = object; o && o !== Object.prototype; o = Object.getPrototypeOf(o))\n        Object.getOwnPropertyNames(o).forEach(prop => props.add(prop));\n    return props;\n};\n","import { overwrite } from '../object';\nexport const element = name => options => overwrite(document.createElement(name), options);\nexport const append = (parent) => (...children) => children.forEach(child => parent.appendChild(child));\nexport const prevent = (fn) => (event) => { event.preventDefault(); fn && fn(event); };\nexport const frame = () => new Promise(resolve => requestAnimationFrame(resolve));\nexport const context2d = (options) => element('canvas')(options).getContext('2d');\n","export const renderer = (tmpl, arg = '$') => new Function(arg, 'return `' + tmpl + '`');\nexport const render = (tmpl, obj) => renderer(tmpl, '{' + Object.keys(obj) + '}')(obj);\n","import { render } from 'wheels/esm/text/template'\n\nexport class Shader {\n  command: any\n\n  constructor(\n    private readonly regl: any,\n    private readonly binds: any\n  ) {}\n\n  compile(arg: any) {\n    const { regl, binds } = this\n    const { vert, frag } = binds\n    this.command = regl({\n      ...binds,\n      ...vert && { vert: render(vert, arg) },\n      ...frag && { frag: render(frag, arg) }\n    })\n  }\n}\n","import { Shader } from '../Shader'\nimport vert from 'glsl/setup.vert'\n\nexport class Setup extends Shader {\n  constructor(regl: any) {\n    super(regl, {\n      vert,\n      depth: {\n        enable: false\n      },\n      attributes: {\n        aPosition: [1, 1, -1, 1, 1, -1, -1, -1]\n      },\n      primitive: 'triangle strip',\n      count: 4\n    })\n  }\n}\n","import { Shader } from '../Shader'\nimport frag from 'glsl/pass1.frag'\n\nexport class Pass1 extends Shader {\n  constructor(regl: any) {\n    super(regl, {\n      frag,\n      framebuffer: regl.prop('dst'),\n      uniforms: {\n        uSrc: regl.prop('src'),\n        uBrightness: regl.prop('brightness'),\n        uGamma: regl.prop('gamma'),\n        uNoise: regl.prop('noise'),\n        uTime: regl.context('time')\n      }\n    })\n  }\n}\n","import { Shader } from '../Shader'\nimport frag from 'glsl/pass2.frag'\n\nexport class Pass2 extends Shader {\n  constructor(regl: any) {\n    super(regl, {\n      frag,\n      framebuffer: regl.prop('dst'),\n      context: {\n        src: regl.prop('src'),\n        lut: regl.prop('lut')\n      },\n      uniforms: {\n        uSrc: regl.context('src'),\n        uLut: regl.context('lut'),\n        uSrcSize: ({ src }: any) => [ src.width, src.height ],\n        uLutSize: ({ lut }: any) => [ lut.width, lut.height ]\n      }\n    })\n  }\n}\n","import { overwrite } from 'wheels/esm/object'\nimport { context2d } from 'wheels/esm/dom'\nimport { Setup } from './shaders/Setup'\nimport { Pass1 } from './shaders/Pass1'\nimport { Pass2 } from './shaders/Pass2'\nimport { ASCII } from './ASCII'\n\nexport type Renderable =\n  HTMLImageElement  |\n  HTMLCanvasElement |\n  HTMLVideoElement  |\n  ImageBitmap\n\nexport class Renderer {\n  private readonly src: any // regl textures\n  private readonly lut: any\n\n  private readonly fbo1: any // regl framebufers\n  private readonly fbo2: any\n\n  private readonly setup: Setup\n  private readonly pass1: Pass1\n  private readonly pass2: Pass2\n\n  private readonly context = context2d()\n  private readonly canvas = this.context.canvas\n  private bytes = new Uint8Array(1)\n\n  constructor(private readonly ascii: ASCII) {\n    const { regl } = ascii\n\n    this.src = regl.texture()\n    this.lut = regl.texture()\n\n    this.fbo1 = regl.framebuffer({ depthStencil: false, colorType: 'float' })\n    this.fbo2 = regl.framebuffer({ depthStencil: false })\n\n    this.setup = new Setup(regl)\n    this.pass1 = new Pass1(regl)\n    this.pass2 = new Pass2(regl)\n  }\n\n  private resize(renderable: Renderable, width: number, height: number) {\n    const { context, canvas, ascii: { settings: { quality } } } = this\n\n    if (quality === 'low')\n      return renderable\n\n    if (canvas.width !== width || canvas.height !== height) {\n      overwrite(canvas, { width, height })\n      context.imageSmoothingQuality = quality\n    }\n\n    context.drawImage(renderable, 0, 0, width, height)\n\n    return canvas\n  }\n\n  update() {\n    const { ascii } = this\n\n    this.lut({\n      format: 'alpha',\n      type: 'float',\n      data: ascii.luts\n    })\n\n    this.setup.compile(ascii)\n    this.pass1.compile(ascii)\n    this.pass2.compile(ascii)\n  }\n\n  render(renderable: Renderable, width: number, height: number) {\n    const { src, lut, fbo1, fbo2, ascii: { regl, settings } } = this\n    const { brightness, gamma, noise } = settings\n\n    const w = settings.lutWidth  * width\n    const h = settings.lutHeight * height\n\n    const length = width * height << 2\n    if (this.bytes.length !== length)\n      this.bytes = new Uint8Array(length)\n\n    src(this.resize(renderable, w, h))\n\n    fbo1.resize(w, h)\n    fbo2.resize(width, height)\n    regl.poll()\n\n    this.setup.command(() => {\n      this.pass1.command({ dst: fbo1, src, brightness, gamma, noise })\n      this.pass2.command({ dst: fbo2, src: fbo1, lut }, () => {\n        regl.draw()\n        regl.read(this.bytes)\n      })\n    })\n\n    return this.bytes\n  }\n}\n","export class ASCIICoreSettings {\n  optimized  = true\n  quality    = 'high' as ImageSmoothingQuality\n  fontFace   = 'monospace'\n  fontWidth  = 40\n  fontHeight = 70\n  fontBlur   = 6\n  lutWidth   = 5\n  lutHeight  = 7\n  lutPadding = 1\n  brightness = 1\n  gamma      = 1\n  noise      = 0\n}\n","import { round } from 'wheels/esm/math'\nimport { ASCIICoreSettings } from './ASCIICoreSettings'\n\nexport class ASCIISettings extends ASCIICoreSettings {\n  get lutWidthPadded()   { return this.lutPadding*2 + this.lutWidth }\n  get lutHeightPadded()  { return this.lutPadding*2 + this.lutHeight }\n  get lutWidthRatio()    { return this.lutWidthPadded  / this.lutWidth }\n  get lutHeightRatio()   { return this.lutHeightPadded / this.lutHeight }\n  get fontWidthPadded()  { return round(this.lutWidthRatio  * this.fontWidth) }\n  get fontHeightPadded() { return round(this.lutHeightRatio * this.fontHeight) }\n}\n","import { max, clz32 } from 'wheels/esm/math'\nimport { context2d } from 'wheels/esm/dom'\n\n/** Most Significant Bit, but f(x) is always >=1 */\nconst msb = (n: number) => 1 << max(0, 31 - clz32(n))\n\nconst fallback = (src: CanvasRenderingContext2D, width: number, height: number) => {\n  let w = msb(src.canvas.width  / width  - 1) * width\n  let h = msb(src.canvas.height / height - 1) * height\n\n  const tmp = context2d({ width: w, height: h })\n  tmp.drawImage(src.canvas, 0, 0, w, h)\n  for (let x: any, y: any; (x = w > width) || (y = h > height);)\n    tmp.drawImage(tmp.canvas, 0, 0, w, h, 0, 0, w >>= x, h >>= y)\n\n  const dst = context2d({ width, height })\n  dst.drawImage(tmp.canvas, 0, 0)\n  return dst\n}\n\nconst native = (src: CanvasRenderingContext2D, width: number, height: number) => {\n  const dst = context2d({ width, height })\n  dst.imageSmoothingQuality = 'medium'\n  dst.drawImage(src.canvas, 0, 0, width, height)\n  return dst\n}\n\nexport const downscale =\n  'imageSmoothingQuality' in CanvasRenderingContext2D.prototype\n    ? native\n    : fallback\n","import { rgb } from 'wheels/esm/color/srgb'\nimport { max, floor } from 'wheels/esm/math'\nimport { range } from 'wheels/esm/fp'\nimport { overwrite } from 'wheels/esm/object'\nimport { element, context2d } from 'wheels/esm/dom'\nimport { Renderer, Renderable } from './Renderer'\nimport { ASCIICoreSettings } from './ASCIICoreSettings'\nimport { ASCIISettings } from './ASCIISettings'\nimport { downscale } from '../downscale'\n\nconst charCodes = function* () {\n  yield* range(0x20, 0x7f)\n  yield* range(0xa1, 0xc0)\n  yield* range(0x2018, 0x2020)\n}\n\nexport class ASCII {\n  regl: any\n  luts!: Float32Array[]\n  renderer: Renderer\n  settings = new ASCIISettings\n  charMap = new Uint16Array(charCodes())\n\n  constructor(REGL: any, settings?: Partial<ASCIICoreSettings>) {\n    const canvas = element('canvas')()\n    const extensions = [ 'OES_texture_float' ]\n    this.regl = REGL({ canvas, extensions })\n    this.renderer = new Renderer(this)\n    this.update(settings)\n  }\n\n  private makeGlyph(charCode: number) {\n    const { fontFace, fontBlur, fontWidth, fontHeight, fontWidthPadded, fontHeightPadded } = this.settings\n    const glyph = context2d({ width: fontWidthPadded, height: fontHeightPadded })\n    const char = String.fromCharCode(charCode)\n\n    glyph.fillStyle = '#00f'\n    glyph.fillRect(0, 0, fontWidthPadded, fontHeightPadded)\n\n    glyph.fillStyle = '#000'\n    glyph.translate(fontWidthPadded/2, fontHeightPadded/2)\n    glyph.fillRect(-fontWidth/2, -fontHeight/2, fontWidth, fontHeight)\n\n    glyph.fillStyle = '#fff'\n    glyph.textAlign = 'center'\n    glyph.font = `${fontHeight}px ${fontFace}`\n    glyph.translate(0, fontHeight/4)\n\n    for (let i = 0; i < fontBlur;) {\n      glyph.filter = `blur(${1<<i}px)`\n      glyph.globalAlpha = ++i/fontBlur\n      glyph.fillText(char, 0, 0)\n    }\n\n    return glyph\n  }\n\n  private makeLut(charCode: number) {\n    const { lutWidth, lutHeight, lutPadding, lutWidthPadded, lutHeightPadded } = this.settings\n    const scaled = downscale(this.makeGlyph(charCode), lutWidthPadded, lutHeightPadded)\n    const bytes = scaled.getImageData(lutPadding, lutPadding, lutWidth, lutHeight).data\n    const floats = new Float32Array(bytes.length >> 2)\n\n    for (let i = 0; i < floats.length; i++)\n      floats[i] = bytes[i << 2] / 0xff\n\n    return floats\n  }\n\n  private makeLuts() {\n    const luts = Array.from(this.charMap, cc => this.makeLut(cc))\n    const brightest = luts.reduce((m, lut) => max(m, ...lut), 0)\n\n    for (const lut of luts)\n      for (let i = 0; i < lut.length; i++)\n        lut[i] = rgb(lut[i] / brightest)\n\n    return luts\n  }\n\n  private *map(bytes: Uint8Array, width: number, height: number) {\n    const { charMap } = this\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++)\n        yield charMap[bytes[x + y*width << 2]]\n      yield 0xa\n    }\n  }\n\n  update(settings?: Partial<ASCIICoreSettings>) {\n    overwrite(this.settings, settings!)\n    this.luts = this.makeLuts()\n    this.renderer.update()\n  }\n\n  render(renderable: Renderable, width: number, height: number) {\n    const width聞 = floor(width), height聞 = floor(height)\n    const bytes = this.renderer.render(renderable, width聞, height聞)\n    const chars = String.fromCharCode(...this.map(bytes, width聞, height聞))\n    return chars\n  }\n}\n"],"names":["rgb","srgb","clz32","floor","max","round","Math","range","min","step","number","overwrite","Object","assign","element","name","options","document","createElement","context2d","getContext","render","tmpl","obj","arg","Function","renderer","keys","Shader","[object Object]","regl","binds","this","vert","frag","command","Setup","super","depth","enable","attributes","aPosition","primitive","count","Pass1","framebuffer","prop","uniforms","uSrc","uBrightness","uGamma","uNoise","uTime","context","Pass2","src","lut","uLut","uSrcSize","width","height","uLutSize","Renderer","ascii","canvas","Uint8Array","texture","fbo1","depthStencil","colorType","fbo2","setup","pass1","pass2","renderable","settings","quality","imageSmoothingQuality","drawImage","format","type","data","luts","compile","brightness","gamma","noise","w","lutWidth","h","lutHeight","length","bytes","resize","poll","dst","draw","read","ASCIICoreSettings","ASCIISettings","lutWidthPadded","lutPadding","lutHeightPadded","lutWidthRatio","lutHeightRatio","fontWidthPadded","fontWidth","fontHeightPadded","fontHeight","msb","n","downscale","CanvasRenderingContext2D","prototype","tmp","x","y","charCodes","REGL","Uint16Array","extensions","update","charCode","fontFace","fontBlur","glyph","char","String","fromCharCode","fillStyle","fillRect","translate","textAlign","font","i","filter","globalAlpha","fillText","makeGlyph","getImageData","floats","Float32Array","Array","from","charMap","cc","makeLut","brightest","reduce","m","makeLuts","width聞","height聞","map"],"mappings":"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"}